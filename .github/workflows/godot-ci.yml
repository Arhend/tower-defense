name: "godot-ci export"
on: push

env:
  GODOT_VERSION: 4.5.1
  EXPORT_NAME: tower-defense
  PROJECT_PATH: .

jobs:
  export:
    name: Export Game
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          lfs: true
      - name: Build Docker Image
        run: docker build -t godot-builder .
      - name: Export Windows
        run: |
          mkdir -p build/windows
          docker run --rm -v "$(pwd):/workspace" godot-builder \
            godot --headless --verbose --export-release "Windows Desktop" "/workspace/build/windows/$EXPORT_NAME.exe"
      - name: Export Linux
        run: |
          mkdir -p build/linux
          docker run --rm -v "$(pwd):/workspace" godot-builder \
            godot --headless --verbose --export-release "Linux/X11" "/workspace/build/linux/$EXPORT_NAME.x86_64"
      - name: Export macOS
        run: |
          mkdir -p build/mac
          docker run --rm -v "$(pwd):/workspace" godot-builder \
            godot --headless --verbose --export-release "macOS" "/workspace/build/mac/$EXPORT_NAME.zip"
      - name: Upload Windows
        uses: actions/upload-artifact@v4
        with:
          name: windows
          path: build/windows
      - name: Upload Linux
        uses: actions/upload-artifact@v4
        with:
          name: linux
          path: build/linux
      - name: Upload macOS
        uses: actions/upload-artifact@v4
        with:
          name: mac
          path: build/mac
